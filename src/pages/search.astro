---
import Result from '../component/result.astro'
import Fuse from 'fuse.js'
import { getCollection } from 'astro:content'

const entries = await getCollection(
  'entries',
  ({ data }) => data.type === 'kelompok'
)

const fuse = new Fuse(entries, {
  keys: ['data.code', 'data.name', 'body'],
  includeMatches: true,
  minMatchCharLength: 2
})

const query = Astro.url.searchParams.get('q')
const results = fuse.search(query || '').map((res) => res.item)

export const partial = true
export const prerender = false
---

<Fragment>
  {results.map((entry) => <Result entry={entry} />)}
</Fragment>
